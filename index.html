<!doctype html>
<html>

<head>

  <title>EPSchedule</title>
  <meta charset="utf=8">
  <meta name="viewport"
        content="width=device-width, minimum-scale=1.0, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <script src="bower_components/webcomponentsjs/webcomponents.js">
  </script>
  <script>
  document.onkeydown = function(event) {
    if (event.keyCode == 37) { //Left
        dateBack();
    } else if (event.keyCode == 39) { //Right
        dateForward;
    }
  }
  </script>
  <script>
  var schedule = {{ schedule | safe }};
  var days = {{days | safe }};
  var globalDate = new Date();
  function dateBack() {
    globalDate.setDate(globalDate.getDate()-1);
    renderSchedule(globalDate, true);
  }
  function dateForward() {
    globalDate.setDate(globalDate.getDate()+1);
    renderSchedule(globalDate, true);
  }
  function renderSchedule(dateObj, emptyDiv) {
    var div = document.getElementById("container");
    if (emptyDiv) {
        div.innerHTML = "";
    }
    appendPara(div, ((dateObj.getMonth() + 1) + "/" + dateObj.getDate() + "/" + dateObj.getFullYear())); //Display date
    switch (dateObj.getDay()) { //Spits out the day of the week as a string
        case 0: //Intentionall fallthrough - requesting a Sunday or Saturday schedule should spit out a Monday schedule
        case 6:
        case 1:
            var day = "Monday";
            break;
        case 2:
            var day = "Tuesday";
            break;
        case 3:
            var day = "Wednesday";
            break;
        case 4:
            day = "Thursday";
            break;
        case 5:
            day = "Friday";
            break;
    }
    for (var exception = 0; exception < days[1].length; exception++) { //Handles exceptions, also handles special weekend schedules
        if (days[1][exception]["day"] == dateObj.getDate() && days[1][exception]["month"] == (dateObj.getMonth() + 1) && days[1][exception]["year"] == dateObj.getFullYear()) {
            day = days[1][exception]["schedule"];
        }
    }
    var currentSlot;
    for (currentSlot = 0; currentSlot < days[0][day]["MS"].length; currentSlot++) {
        switch(days[0][day]["MS"][currentSlot]["period"]) { //Falling through is intended in switch statement
            case "A": //A period
            case "B": //B period
            case "C": //C period
            case "D": //D period
            case "E": //E period
            case "F": //F period
            case "G": //G period
            case "H": //H period
                for (var k = 0; k < schedule["classes"].length; k++) {
                    if (schedule["classes"][k]["period"] == days[0][day]["MS"][currentSlot]["period"]) {
                        var scheduleObj = { name: schedule["classes"][k]["name"],
                        teacher: schedule["classes"][k]["teacher"],
                        room: schedule["classes"][k]["room"],
                        period: days[0][day]["MS"][currentSlot]["period"],
                        time: "will be determined later" };
                    }
                }
                break;
            case "Lunch":
                var scheduleObj = { name: "Lunch", teacher: "N/A", room: "LPC Commons", period: 9, time: "will be determined later" };
                break;
            case "Assembly":
                var scheduleObj = { name: "Assembly", teacher: "N/A", room: "LPC Commons", period: 10, time: "will be determined later" };
                break;
            case "Advisory":
                var scheduleObj = { name: "Advisory", teacher: "Advisor", room: "Varies", period: 11, time: "will be determined later" }; //TODO - Make this box display the user's advisor and advisory location
                break;
            case "Class Meeting":
                var scheduleObj = { name: "Class Meeting", teacher: "Grade Level Advisors", room: "Varies", period: 12, time: "will be determined later" };
                break;
            case "Clubs":
                var scheduleObj = { name: "Clubs", teacher: "Varies", room: "Varies", period: 13, time: "will be determined later" };
                break;
        }
        try {
            scheduleObj["time"] = days[0][day]["MS"][currentSlot]["time"];
            appendParaLink(div, scheduleObj);
        } catch (error) {
        }
    }

  }
  window.onload = function() {
    //var div = document.getElementById("schedule");
    var date = new Date();
    renderSchedule(date, false);
  }
  function appendLink(url, text) {
    var anchor = document.createElement("a");
    anchor.href = url;
    var node = document.createTextNode(text);
    anchor.appendChild(node);
    return anchor
  }
  function appendParaLink(div, obj) {
    var para = document.createElement("p"); //Creates the para
    para.appendChild(appendLink(("/class/" + cleanString(obj["name"])), obj["name"]));
    para.appendChild(document.createTextNode(" - "));
    para.appendChild(appendLink(("/teacher/" + obj["teacher"]), obj["teacher"]));
    para.appendChild(document.createTextNode(" - "));
    para.appendChild(appendLink(("/room/" + obj["room"]), obj["room"]));
    para.appendChild(document.createTextNode(" - "));
    para.appendChild(appendLink(("/period/" + obj["period"]), obj["time"]));
    div.appendChild(para); //Adds the para to the div
  }

  function appendPara(div, text) {
    var para = document.createElement("p");
    var node = document.createTextNode(text);
    para.appendChild(node);
    div.appendChild(para);
  }

  function cleanString(text) {
    text = text.toLowerCase();
    text = text.replace(/ /g, "_"); //Remove spaces
    text = text.replace(/-/g, ""); //Remove dashes
    text = text.replace(/\./g, ""); //Remove periods
    return text;
  }

  /*function convertNumToChar(number) {
    switch(number){
        case 1:
            return "A";
        case 2:
            return "B";
        case 3:
            return "C";
        case 4:
            return "D";
        case 5:
            return "E";
        case 6:
            return "F";
        case 7:
            return "G";
        case 8:
            return "H";
  }*/
  </script>

  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="bower_components/font-roboto/roboto.html">
  <link rel="import"
    href="bower_components/core-toolbar/core-toolbar.html">
  <link rel="import"
    href="bower_components/core-header-panel/core-header-panel.html">
  <link rel="import"
    href="bower_components/core-icons/core-icons.html">
  <link rel="import"
    href="bower_components/paper-icon-button/paper-icon-button.html">
  <link rel="import" href="item.html">

  <style>
  html,body {
    height: 100%;
    margin: 0;
    #background-color: #e6eef4;
    font-family: 'RobotoDraft', sans-serif;
  }
  core-header-panel {
    height: 100%;
    #background: green;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }
  core-toolbar {
    background: #025992;
    color: white;
  }
  #tabs {
    width: 100%;
    margin: 0;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  text-transform: uppercase;
  }
  .container {
    width: 80%;
    margin: 24px auto;
    #background:blue;
  }
  @media (min-width: 720px) {
    .container {
      width: 540px;
    }
  }
  </style>

</head>

<body unresolved>
  <core-header-panel>

    <core-toolbar>
     <paper-icon-button id="navicon"
        icon="menu"></paper-icon-button>
    <span flex>Today</span>
    <span><paper-icon-button icon="arrow-back" onclick="dateBack()"></paper-icon-button></span>
    <span><paper-icon-button icon="arrow-forward" onclick="dateForward()"></paper-icon-button></span>
    </core-toolbar>
    <div id="container" class="container" layout vertical center>
    </div>
  </core-header-panel>
</body>

</html>